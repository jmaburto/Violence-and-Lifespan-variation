Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
# Create a vector with the countries we are interested in
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
# Create a vector with the countries we are interested in
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
qpois(p = .5,lambda = .7)
sidebarPanel
library(shiny)
library(data.table)
library(DT)
names.c <- toupper(c('Dominican Republic', 'Costa Rica','El Salvador', 'Guatemala','Mexico', 'Nicaragua',
'Argentina', 'Chile', 'Colombia', 'Ecuador', 'Paraguay',
'Peru', 'Uruguay', 'Venezuela', 'Brazil', 'Cuba','Honduras','Panama','Jamaica'))
Sources <- c('CEPAL2004','CEPAL2010','UN')
Periods <- c("1990-1995", "1995-2000" ,"2000-2005" ,"2005-2010")
sidebarPanel
load('Decomp_results.RData')
setwd("C:/Users/jmaburto/Documents/GitHub/CoD-burden-on-LA/R/Decomp2_App/")
library(shiny)
library(ggplot2)
#rsconnect::setAccountInfo(name='jmaburto',
#                          token='7310E08D0D081D3C3CABCAA90D18045E',
#                          secret='Vzlie6RN39/THGhWKatGf/C68yZp+RENdTdOl/ey')
rsconnect::setAccountInfo(name='wb-lac',
token='06E52479A00F914E6EE44A17FFEA7E80',
secret='D7wg0N0miuHwY8reIRkCRy38E+TSCGXy+nHgm+KH')
load('Decomp_results.RData')
library(ggplot2)
library(data.table)
load('Decomp_results.RData')
setwd("C:/Users/jmaburto/Documents/GitHub/CoD-burden-on-LA/R/Decomp2_App/")
exit
library(plotly)
shiny::runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
# Results at the national level
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
source('R/2_1_LifeExpectancy&LifeDisparity.R')
source('R/Functions.R')
Decomp.ex <- local(get(load("'Data/DecompResults_ex_List.RData'")))
Decomp.ex <- local(get(load("Data/DecompResults_ex_List.RData")))
Decomp.ed <- local(get(load("Data/DecompResults_ed_List.RData")))
length(Decomp.ed)
i <-1
x <- Decomp.ex[[i]]
x <- Decomp.ex[[i]]
x
length(x)
j <-1
i <- 1
DecompIn <- x
i
Z        <- DecompIn[[i]]
Z
Z        <- lapply(1:length(Z), function(ii,Z){
XX       <- as.data.frame(Z[[ii]])
XX$State <- ii
XX$Age   <- 0:109
XX
}, Z = Z)
Z
Z        <- DecompIn[[i]]
Z
Z        <- DecompIn[[i]]
Z
D        <- do.call(rbind.data.frame, Z)
D
View(D)
names(z)
names(Z)
length(Z)
Z        <- DecompIn[[i]]
Z
length(Decomp.ex)
i <-1
x <- Decomp.ex[[i]]
length(x)
names(x)
DecompIn=x
i=colnames(x)
i
names(x)
Z        <- DecompIn[[as.character(i)]]
as.character(i)
i
names(x)
i=names(x)[1]
i
Z        <- DecompIn[[as.character(i)]]
Z.names  <- names(Z)
Z.names
Z
names(x)
names(x)
Z        <- DecompIn[[as.character(i)]]
Z
Z.names  <- names(Z)
Z.names
i
Z.names  <- names(Z)
Z.names
Z        <- DecompIn[[as.character(i)]]
Z
Z.names  <- names(Z)
Z.names
Z.names
Z        <- DecompIn[[as.character(i)]]
Z
Z.names  <- names(Z)
Z.names
ii
Z.names
ii=Z.names[1]
ii
Z2      <- Z[[as.character(ii)]]
Z2
i
ii
i
ii
XX      <- cbind(state=i,year=ii,age=0:109,Z2)
XX
XX      <- cbind(state=as.integer(i),year=as.integer(ii),age=0:109,Z2)
XX
Z        <- DecompIn[[as.character(i)]]
Z.names  <- names(Z)
ZZ        <- lapply(Z.names, function(ii,Z){
Z2      <- Z[[as.character(ii)]]
XX      <- cbind(state=as.integer(i),year=as.integer(ii),age=0:109,Z2)
XX
}, Z = Z,i=i)
Z.names
Z        <- DecompIn[[as.character(i)]]
Z        <- DecompIn[[i]]
i
i
Z        <- DecompIn[[i]]
Z.names  <- names(Z)
Z.names
ZZ        <- lapply(Z.names, function(ii,Z,i){
Z2      <- Z[[as.character(ii)]]
XX      <- cbind(state=as.integer(i),year=as.integer(ii),age=0:109,Z2)
XX
}, Z = Z,i=i)
D        <- do.call(rbind.data.frame, Z)
D        <- do.call(rbind.data.frame, ZZ)
library(data.table)
library(reshape2)
rbind.data.table
source('~/GitHub/Violence-and-Lifespan-variation/R/Functions.R', echo=TRUE)
do.call(rbind.data.table, ZZ)
D        <- do.call(rbind.data.table, ZZ)
D        <- do.call(rbind, ZZ)
View(D)
DT       <- as.data.table(melt(D,
id.vars = list("state","age"),
variable.name = "Cause"))
DT
D        <- do.call(rbind, ZZ)
Z        <- DecompIn[[i]]
Z.names  <- names(Z)
ZZ        <- lapply(Z.names, function(ii,Z,i){
Z2      <- Z[[as.character(ii)]]
XX      <- cbind(state=as.integer(i),year=as.integer(ii),age=0:109,Z2)
XX
}, Z = Z,i=i)
D        <- as.data.frame(do.call(rbind, ZZ))
DT       <- as.data.table(melt(D,
id.vars = list("state","year","age"),
variable.name = "Cause"))
D        <- as.data.frame(do.call(rbind, ZZ))
DT       <- as.data.table(melt(D,
id.vars = list("state","year","age"),
variable.name = "Cause", stringsAsFactors=FALSE))
D
D
D        <- data.table(D)
DF.Decomp.ex <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
my_reshape.function <- function(i=names(x)[1],DecompIn=x){
Z        <- DecompIn[[i]]
Z.names  <- names(Z)
ZZ        <- lapply(Z.names, function(ii,Z,i){
Z2      <- Z[[as.character(ii)]]
XX      <- cbind(state=as.integer(i),year=as.integer(ii),age=0:109,Z2)
XX
}, Z = Z,i=i)
# now stick it together
D        <- as.data.frame(do.call(rbind, ZZ))
D        <- data.table(D)
#DT       <- as.data.table(melt(D,
#                               id.vars = list("state","year","age"),
#                               variable.name = "Cause"))
D
}
DF.Decomp.ex <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
View(DF.Decomp.ex)
DT.Results.ed <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ex))
DT.Results.ex <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ex))
unique(DT.Results.ex$sex)
unique(DT.Results.ex$state)
unique(DT.Results.ex$year)
unique(DT.Results.ex$age)
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
source('R/2_1_LifeExpectancy&LifeDisparity.R')
source('R/Functions.R')
Decomp.ex <- local(get(load("Data/DecompResults_ex_List.RData")))
Decomp.ed <- local(get(load("Data/DecompResults_ed_List.RData")))
DT.Results.ex <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ex))
#get results for decomp in ed un a data.table
DT.Results.ed <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ed))
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
source('R/2_1_LifeExpectancy&LifeDisparity.R')
source('R/Functions.R')
Decomp.ex <- local(get(load("Data/DecompResults_ex_List.RData")))
Decomp.ed <- local(get(load("Data/DecompResults_ed_List.RData")))
#get results for decomp in ex un a data.table
DT.Decomp.ex <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ex))
#get results for decomp in ed un a data.table
DT.Decomp.ed <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ed))
gdata::keep(DT.Decomp.ed,DT.Decomp.ex,DT.LTmx,DT.mxCOD,sure = T)
CoD.name.vec <- c('Infectious and respiratory', 'Cancers', 'Circulatory',
'Birth conditions', 'Diabetes', 'Other AMS', 'IHD', 'HIV',
'Suicide', 'Lung Cancer', 'Cirrhosis', 'Homicide',
'RTA', 'Other HD', 'Rest')
CoD.name.vec
CoD.code.vec <- paste(Cause1,c(1:14,16))
CoD.code.vec
CoD.code.vec <- paste0('Cause',c(1:14,16))
CoD.code.vec
region.recvec            <- c(0,2,3,3,1,3,2,1,3,2,3,2,1,2,2,2,
2,1,2,3,1,1,2,1,3,3,3,1,3,2,1,1,3)
length(region.recvec)
names(state.name.vec) <- state.code.vec
state.code.vec
# useful labels
CoD.name.vec <- c('Infectious and respiratory', 'Cancers', 'Circulatory',
'Birth conditions', 'Diabetes', 'Other AMS', 'IHD', 'HIV',
'Suicide', 'Lung Cancer', 'Cirrhosis', 'Homicide',
'RTA', 'Other HD', 'Rest')
CoD.code.vec <- paste0('Cause',c(1:14,16))
CoD.name.vec2 <- c('Amenable','Diabetes','IHD', 'HIV',
'Suicide', 'Lung Cancer', 'Cirrhosis', 'Homicide',
'Road traffic accidents', 'Other')
CoD.code.vec2 <- 1:10
state.name.vec <- c("National","Aguascalientes","Baja California","Baja California Sur","Campeche",
"Coahuila","Colima","Chiapas","Chihuahua","Mexico City","Durango",
"Guanajuato","Guerrero","Hidalgo","Jalisco","Mexico State","Michoacán",
"Morelos","Nayarit","Nuevo León","Oaxaca","Puebla","Querétaro",
"Quintana Roo","San Luis Potosí","Sinaloa","Sonora","Tabasco","Tamaulipas",
"Tlaxcala","Veracruz","Yucatán","Zacatecas")
state.code.vec <- 0:32
names(state.name.vec) <- state.code.vec
region.recvec            <- c(0,2,3,3,1,3,2,1,3,2,3,2,1,2,2,2,
2,1,2,3,1,1,2,1,3,3,3,1,3,2,1,1,3)
names(region.recvec)     <- 0:32
source('R/Functions_2.R')
state.name.vec[as.character(DT.Decomp.ed$state)]
names(state.name.vec)
CoD.name.vec <- c('Infectious and respiratory', 'Cancers', 'Circulatory',
'Birth conditions', 'Diabetes', 'Other AMS', 'IHD', 'HIV',
'Suicide', 'Lung Cancer', 'Cirrhosis', 'Homicide',
'RTA', 'Other HD', 'Rest')
CoD.code.vec <- paste0('Cause',c(1:14,16))
CoD.name.vec2 <- c('Amenable','Diabetes','IHD', 'HIV',
'Suicide', 'Lung Cancer', 'Cirrhosis', 'Homicide',
'Road traffic accidents', 'Other')
CoD.code.vec2 <- 1:10
state.name.vec <- c("National","Aguascalientes","Baja California","Baja California Sur","Campeche",
"Coahuila","Colima","Chiapas","Chihuahua","Mexico City","Durango",
"Guanajuato","Guerrero","Hidalgo","Jalisco","Mexico State","Michoacán",
"Morelos","Nayarit","Nuevo León","Oaxaca","Puebla","Querétaro",
"Quintana Roo","San Luis Potosí","Sinaloa","Sonora","Tabasco","Tamaulipas",
"Tlaxcala","Veracruz","Yucatán","Zacatecas")
state.name.vec
state.code.vec <- 0:32
state.code.vec
state.code.vec <- 0:32
names(state.name.vec) <- state.code.vec
names(state.name.vec)
region.recvec            <- c(0,2,3,3,1,3,2,1,3,2,3,2,1,2,2,2,
2,1,2,3,1,1,2,1,3,3,3,1,3,2,1,1,3)
names(region.recvec)     <- 0:32
DT.Decomp.ed  <- state.name.vec[as.character(DT.Decomp.ed$state)]
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
source('R/2_1_LifeExpectancy&LifeDisparity.R')
source('R/Functions.R')
Decomp.ex <- local(get(load("Data/DecompResults_ex_List.RData")))
Decomp.ed <- local(get(load("Data/DecompResults_ed_List.RData")))
#get results for decomp in ex un a data.table
DT.Decomp.ex <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ex))
#get results for decomp in ed un a data.table
DT.Decomp.ed <- do.call(rbind,lapply(1:2,function(j,y){
x <- y[[j]]
w <- do.call(rbind,
lapply(names(x),
FUN = my_reshape.function,
DecompIn = x))
W <- cbind(sex = as.integer(j),w)
W
},
y=Decomp.ed))
#DT       <- as.data.table(melt(D,
#                               id.vars = list("state","year","age"),
#                               variable.name = "Cause"))
gdata::keep(DT.Decomp.ed,DT.Decomp.ex,DT.LTmx,DT.mxCOD,sure = T)
source('R/Functions_2.R')
DT.Decomp.ed  <- cbind(state.name.vec[as.character(DT.Decomp.ed$state)],DT.Decomp.ed)
DT.Decomp.ed  <- DT.Decomp.ed
region.recvec            <- c(0,2,3,3,1,3,2,1,3,2,3,2,1,2,2,2,
2,1,2,3,1,1,2,1,3,3,3,1,3,2,1,1,3)
names(region.recvec)     <- 0:32
region.recvec
DT.Decomp.ed  <- cbind(region=region.recvec[as.character(DT.Decomp.ed$state)],DT.Decomp.ed)
View(DT.Decomp.ed)
DT.Decomp.ed  <- cbind(state.name=state.name.vec[as.character(DT.Decomp.ed$state)],DT.Decomp.ed)
DT.Decomp.ed$region  <- factor(DT.Decomp.ed$region, levels = 1:3, labels = c('South', 'Central', 'North'))
# Results at the national level
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
# Results at the national level
rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
source('R/2_3_Reshape_Results.R.R')
source('R/2_3_Reshape_Results.R')
