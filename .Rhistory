install.packages(c("cli", "commonmark", "covr", "data.table", "doParallel", "expm", "ggridges", "grpreg", "htmlwidgets", "later", "maptools", "optimx", "R.matlab", "Rcpp", "stringi", "TTR", "webshot", "zoo"))
DTmex <- read.table('C:/Users/jmaburto/Documents/Data Mexico CONAPO New/ind_dem_proyecciones.csv',header = T,sep = ',',stringsAsFactors = F)
DTmex <- DTmex[,c(2,3,13)]
library(data.table)
DTmex <- data.table(DTmex)
names(DTmex)
names(DTmex) <- c('Year', 'State', 'Female.e0')
DTmex[,max(Female.e0), by = list('Year')]
DTmex[,max(Female.e0)]
DTmex[,max(Female.e0), by = c('Year')]
DTmex[,list(max(Female.e0), State[which.max(Female.e0)]), by = c('Year')]
unique(DTmex$State)
DTmex <- [DTmex$State != ' República Mexicana',]
DTmex[DTmex$State != ' República Mexicana',]
DTmex[DTmex$State != 'República Mexicana',]
DTmex <- DTmex[DTmex$State != 'República Mexicana',]
DTmex[,list(max(Female.e0), State[which.max(Female.e0)]), by = c('Year')]
Max.e0 <- DTmex[,list(max(Female.e0), State[which.max(Female.e0)]), by = c('Year')]
Max.e0
plot(Max.e0$V1)
names(Max.e0) <- c('Year', 'Max.e0', 'State')
save(Max.e0,'Data Mexico CONAPO New/Maxe0.RData')
Max.e0
save(Max.e0,file = 'Data Mexico CONAPO New/Maxe0.RData')
rm(list=ls(all=TRUE))
setwd("C:/Users/jmaburto/Documents/GitHub/Violence-and-Lifespan-variation")
#### sex=1 <- males
#### 1. Infectious and respiratory diseases, 2. Cancers, 3. Circulatory,
#### 4. Birth, 5. Diabetes, 6. Other Medical Care AM
#### 7. IHD, 8. HIV, 9. Suicide, 10. Lung Cancer,
#### 11. Cirrhosis, 12. Homicide, 13. Road traffic accidents,
#### 14. other heart diseases, 15. Ill-defined causes, 16. All other Non-AM
#### Note: these data do not contain Not Specified categories
# devtools::install_github('hadley/ggplot2')
#### Grouping
#### AMS: 7+10+8+9+12, Diabetes, IHD, LUNG CANCER, CIRRHOSIS, HOMICIDES, TRAFFIC ACCIDENTS,
#### REST: 14+21+15+20
library(ggthemes)
library(ggplot2)
library(plotly)
library(RColorBrewer)
library(data.table)
library(reshape2)
source('R/2_3_Reshape_Results.R')
source('R/Functions.R')
# Get some nice colors
#display.brewer.all()
base2 <- c(1:15)
base2 <- c(rev(brewer.pal(8,name = 'Spectral'))[1:5],rev(brewer.pal(8,name = 'Spectral'))[8],rev(brewer.pal(8,name = 'Spectral'))[7],'lightgrey')
# Changes in life expectancy by period for males ------------------------------------
final.y <- 2015
Sex     <- 'Males'
Changes.data   <- DT.LTmx[DT.LTmx$year %in% c(1995,2005,final.y) & DT.LTmx$age == 15 & DT.LTmx$state.name!= 'National',]
Changes.data   <- Changes.data[order(state, sex, year),]
Dif.data.state <- Changes.data[, list(Difference=diff(ex)), by = list(state.name,region,sex,state)]
Changes.data   <- Changes.data[order(state, sex, year),]
Dif.data.state$Difference.ed <- Changes.data[, list(Difference.ed=diff(e.dagger)), by = list(state.name,region,sex,state)]$Difference.ed
Dif.data.state <- Dif.data.state[,Period := c('1995-2005',paste0(2005,'-',final.y)), by = list(state.name,region,sex,state)]
Dif.data.state <- Dif.data.state[,Ref.order := rep(Difference[2],2), by = list(state.name,region,sex,state)]
Dif.data.state <- Dif.data.state[Dif.data.state$sex == Sex,]
Dif.data.state$region <- factor(Dif.data.state$region,levels = rev(levels(Dif.data.state$region)))
head(Dif.data.state)
Dif.data.state$state.name <- reorder(Dif.data.state$state.name,Dif.data.state$Ref.order)
changes.ex.males <- ggplot(Dif.data.state, aes(Difference, state.name)) +
#ggtitle(bquote('A Changes in state male life expectancy '~(e[15])), subtitle = 'by period')+
ggtitle(bquote('A Changes in male life expectancy'))+
geom_vline(xintercept = 0)+
geom_point(data = Dif.data.state, aes(Difference, state.name,col=Period, shape=Period),size = 3) +
facet_grid(region ~., scales = "free", space = "free") +
xlab("Change in years of life") +
theme_light()+
scale_x_continuous(breaks = seq(-1,2,.5),limits = c(-.8,1.75),minor_breaks = seq(-1.25,2.25,.5))+
scale_color_manual(values=base2[c(1,6)])+
theme(axis.title.y=element_blank())+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 14, colour = "black"))+
theme(strip.text.y = element_text(colour = "black"))+
theme(legend.position = 'bottom')
changes.ex.males
changes.ed.males <- ggplot(Dif.data.state, aes(Difference.ed, state.name)) +
#ggtitle(bquote('B Changes in state male lifespan variation '~(e[15]^"\u2020")), subtitle = 'by period')+
ggtitle(bquote('B Changes in male lifespan inequality'))+
geom_vline(xintercept = 0)+
geom_point(data = Dif.data.state, aes(Difference.ed, state.name,col=Period, shape=Period),size = 3) +
facet_grid(region ~., scales = "free", space = "free") +
xlab("Change in years of life") +
theme_light()+
scale_x_continuous(breaks = seq(-1,2,.5),limits = c(-.8,1.75),minor_breaks = seq(-1.25,2.25,.5))+
scale_color_manual(values=base2[c(1,6)])+
theme(axis.title.y=element_blank())+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 14, colour = "black"))+
theme(strip.text.y = element_text(colour = "black"))+
theme(legend.position ='bottom')
changes.ed.males
require(gridExtra)
pdf(file="Manuscript/AJPH Submission/RR2 Submission/changes_males.pdf",width=13,height=7,useDingbats = F)
grid.arrange(changes.ex.males,changes.ed.males,ncol=2)
dev.off()
